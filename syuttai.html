<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100..900&display=swap" rel="stylesheet">
    <title>syuttai</title>

    <style>
        body {
            background: linear-gradient(to bottom, papayawhip, moccasin);
            display: flex;
            justify-content: flex-end;
	    font-family: "Noto Sans JP", sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
        }

        .content {
            margin-right: 25px;
        }

        .header {
            display: grid;
            grid-template-columns: 1fr 1fr 3fr 1fr 1fr;
            justify-content: center; /* ヘッダーを中央に配置 */
            align-items: center;
            margin-top: 10px;
            margin-bottom: 14px;
            border-bottom: 3px solid black; /* 下線を追加 */
            padding-bottom: 3px; /* 下線との間に余白を追加 */
        }

        .text-logo {
         font-size: 28px;
	 font-family: "Noto Sans JP", sans-serif;
         color: #333;
         display: flex;
         align-items: center;
         justify-content: center; /* テキストを横中央に配置 */
         gap: 3px;
        }

       .text-logo .in {
        background: linear-gradient(135deg, #3b82f6, #60a5fa);
        font-size: 20px;
        color: white;
        height: 26px;
        width: 26px;
        display: flex;
        align-items: center; /* テキストを縦中央に配置 */
        justify-content: center; /* テキストを横中央に配置 */
        padding: 2px;
        border-radius: 3px;
        }

       .text-logo .out {
        background: linear-gradient(135deg, #9ca3af, #d1d5db);
        font-size: 20px;
        color: black;
        height: 26px;
        width: 26px;
        display: flex;
        align-items: center; /* テキストを縦中央に配置 */
        justify-content: center; /* テキストを横中央に配置 */
        padding: 2px;
        border-radius: 3px;
        margin-left: 3px;
        }

        .container {
            display: grid;
            grid-template-columns: repeat(11, 45px); /* ボタンの配置を11列 */
            grid-template-rows: repeat(3, 200px); /* ボタンの配置を3行 */
            gap: 9px;
    	    grid-template-areas:
            "i11 i10 i9 i8 i7 i6 i5 i4 i3 i2 i1"
            "i22 i21 i20 i19 i18 i17 i16 i15 i14 i13 i12"
            "i33 i32 i31 i30 i29 i28 i27 i26 i25 i24 i23";
        }

        /* 各ボタンの位置を指定 */
        .i1 { grid-area: i1; }
        .i2 { grid-area: i2; }
        .i3 { grid-area: i3; }
        .i4 { grid-area: i4; }
        .i5 { grid-area: i5; }
        .i6 { grid-area: i6; }
        .i7 { grid-area: i7; }
        .i8 { grid-area: i8; }
        .i9 { grid-area: i9; }
        .i10 { grid-area: i10; }
        .i11 { grid-area: i11; }
        .i12 { grid-area: i12; }
        .i13 { grid-area: i13; }
        .i14 { grid-area: i14; }
        .i15 { grid-area: i15; }
        .i16 { grid-area: i16; }
        .i17 { grid-area: i17; }
        .i18 { grid-area: i18; }
        .i19 { grid-area: i19; }
        .i20 { grid-area: i20; }
        .i21 { grid-area: i21; }
        .i22 { grid-area: i22; }
        .i23 { grid-area: i23; }
        .i24 { grid-area: i24; }
        .i25 { grid-area: i25; }
        .i26 { grid-area: i26; }
        .i27 { grid-area: i27; }
        .i28 { grid-area: i28; }
        .i29 { grid-area: i29; }
        .i30 { grid-area: i30; }
        .i31 { grid-area: i31; }
        .i32 { grid-area: i32; }
        .i33 { grid-area: i33; }

        .button {
            width: 45px;
            height: 200px;
            background-color: #f0f0f0;
            writing-mode: vertical-rl;
            text-align: center;
	    font-family: "Noto Sans JP", sans-serif;
            font-size: 20px; /* テキストのフォントサイズを20ピクセルに設定 */
            color: black; /* テキストの色を黒に設定 */
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer; /* カーソルをポインタに設定 */
            border: 1.5px solid silver;
            box-shadow: 3px 3px 0 grey; /* ボタンの影の設定 */
            border-radius: 5px; /* 角丸設定 */
            transition: all 0.3s ease; /* ボタンのすべてのプロパティに0.3秒のトランジション効果を設定 */
        }

        .button.clicked {
            background-color: blue; /* クリック後のボタンの背景色 */
            color: white; /* クリック後のテキストの色を白に設定 */
            box-shadow: 3px 3px 3px rgba(0, 0, 255, 0.7); /* クリック後のボックスシャドウを設定 */
        }

        .button.hidden {
            display: none;
        }


        /* ハンバーガーメニューアイコン */
        .menu-icon {
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            width: 20px;
            height: 20px;
            cursor: pointer;
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
        }

        .menu-icon div {
            width: 100%;
            height: 2px;
            background-color: black;
            transition: all 0.3s ease;
        }

        /* メニューのスタイル */
        .menu {
            position: fixed;
            top: 0;
            right: 0;
            height: 100vh;
            width: 0;
            background-color: grey;
            color: white;
            overflow-x: hidden;
            transition: width 0.3s ease;
            z-index: 999;
        }

        .menu.active {
            width: 250px; /* メニューが表示されるときの幅 */
        }

        .menu ul {
            list-style: none;
            padding: 0;
            margin-top: 50px;
        }

        .menu ul li {
            padding: 15px 20px;
            border-bottom: 1px solid #555;
        }

        .menu ul li a {
            color: white;
            text-decoration: none;
            font-size: 18px;
            display: block;
        }

        .menu ul li a:hover {
            background-color: #555;
        }

        /* メニューアイコンがアクティブな時のスタイル変更 */
        .menu-icon.active div:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }

        .menu-icon.active div:nth-child(2) {
            opacity: 0;
        }

        .menu-icon.active div:nth-child(3) {
            transform: rotate(-45deg) translate(5px, -5px);
        }

    </style>
</head>

<body>
    <!-- ハンバーガーメニューアイコン -->
    <div class="menu-icon" onclick="toggleMenu()">
        <div></div>
        <div></div>
        <div></div>
    </div>

    <!-- メニュー -->
    <div class="menu" id="menu">
        <ul>
            <li><span onclick="downloadCSV()" style="cursor: pointer;">出退状況記録</span></li>
            <li><span onclick="clearLocalStorage()" style="cursor: pointer;">クリア</span></li>
        </ul>
    </div>

    <div class="content">

    <div class="header">
      <div class="text-logo"></div>
      <div class="text-logo"></div>
      <div class="text-logo">
        <span>議</span>
        <span>員</span>
        <span>出</span>
        <span>退</span>
        <span>表</span>
        <span>示</span>
      </div>
      <div class="text-logo">
        <span class="in">出</span>
        <span class="out">退</span>
      </div>
      <div class="text-logo"></div>
    </div>

    <div class="container">
	<button class="button i1" data-button-name="清川雅史" onclick="toggleColorAndSave(this)">議　長　清川　雅史</button>
	<button class="button i2" data-button-name="横山淳" onclick="toggleColorAndSave(this)">副議長　横山　　淳</button>
	<button class="button i3" data-button-name="平田久美" onclick="toggleColorAndSave(this)">平田　久美</button>
	<button class="button i4" data-button-name="笹内直幸" onclick="toggleColorAndSave(this)">笹内　直幸</button>
	<button class="button i5" data-button-name="中川廣文" onclick="toggleColorAndSave(this)">中川　廣文</button>
	<button class="button i6" data-button-name="柾屋奈津子" onclick="toggleColorAndSave(this)">柾屋奈津子</button>
	<button class="button i7" data-button-name="大島智子" onclick="toggleColorAndSave(this)">大島　智子</button>
	<button class="button i8" data-button-name="長谷川純一" onclick="toggleColorAndSave(this)">長谷川純一</button>
	<button class="button i9" data-button-name="髙橋義人" onclick="toggleColorAndSave(this)">髙橋　義人</button>
	<button class="button i10" data-button-name="小畑匠" onclick="toggleColorAndSave(this)">小畑　　匠</button>
	<button class="button i11" data-button-name="奥脇康夫" onclick="toggleColorAndSave(this)">奥脇　康夫</button>

	<button class="button i14" data-button-name="内海基" onclick="toggleColorAndSave(this)">内海　　基</button>
	<button class="button i15" data-button-name="吉田恵三" onclick="toggleColorAndSave(this)">吉田　恵三</button>
	<button class="button i16" data-button-name="村澤智" onclick="toggleColorAndSave(this)">村澤　　智</button>
	<button class="button i17" data-button-name="小倉孝太郎" onclick="toggleColorAndSave(this)">小倉孝太郎</button>
	<button class="button i18" data-button-name="髙梨浩" onclick="toggleColorAndSave(this)">髙梨　　浩</button>
	<button class="button i19" data-button-name="原田俊広" onclick="toggleColorAndSave(this)">原田　俊広</button>
	<button class="button i20" data-button-name="大山享子" onclick="toggleColorAndSave(this)">大山　享子</button>
	<button class="button i21" data-button-name="譲矢隆" onclick="toggleColorAndSave(this)">譲矢　　隆</button>
	<button class="button i22" data-button-name="長郷潤一郎" onclick="toggleColorAndSave(this)">長郷潤一郎</button>

	<button class="button i25" data-button-name="丸山さよ子" onclick="toggleColorAndSave(this)">丸山さよ子</button>
	<button class="button i26" data-button-name="古川雄一" onclick="toggleColorAndSave(this)">古川　雄一</button>
	<button class="button i27" data-button-name="大竹俊哉" onclick="toggleColorAndSave(this)">大竹　俊哉</button>
	<button class="button i28" data-button-name="松崎新" onclick="toggleColorAndSave(this)">松崎　　新</button>
	<button class="button i29" data-button-name="渡部認" onclick="toggleColorAndSave(this)">渡部　　認</button>
	<button class="button i30" data-button-name="石田典男" onclick="toggleColorAndSave(this)">石田　典男</button>
	<button class="button i31" data-button-name="成田芳雄" onclick="toggleColorAndSave(this)">成田　芳雄</button>
        </div>
    </div>

<!-- 登退庁時間取得のスクリプト -->
    <script>
// ページが読み込まれたときにローカルストレージをクリア
        window.onload = function() {
            clearLocalStorage(); 
        };

    function toggleColorAndSave(button) {
        const buttonName = button.getAttribute('data-button-name'); /* ボタン名を 'data-button-name' 属性から取得 */
        button.classList.toggle('clicked'); /* クリックされたボタンに 'clicked' クラスをトグル（追加/削除） */
        
        const now = new Date(); /* 現在の日時を取得 */
        const timestamp = now.toLocaleString('ja-JP', { timeZone: 'Asia/Tokyo' }); /* 日本時間で日時をフォーマット */
        
        const clicks = JSON.parse(localStorage.getItem(buttonName)) || []; /* ローカルストレージからクリックデータを取得し、存在しない場合は空の配列を設定 */
        const action = (clicks.length % 2 === 0) ? '登庁' : '退庁'; /* クリック回数に基づいて登庁または退庁を設定 */
        
        clicks.push({ action: `${buttonName} ${action}`, timestamp }); /* クリックデータを配列に追加 */
        localStorage.setItem(buttonName, JSON.stringify(clicks)); /* ローカルストレージにクリックデータを保存 */
    }

    // CSVファイルをダウンロードする関数
    function downloadCSV() {
        let csvContent = "data:text/csv;charset=utf-8,"; // CSVファイルのヘッダー

        const buttons = document.querySelectorAll('button[data-button-name]'); // すべてのボタンを取得
        buttons.forEach(button => {
            const buttonName = button.getAttribute('data-button-name'); // 各ボタンの名前を取得
            const clicks = JSON.parse(localStorage.getItem(buttonName)) || []; // クリックデータを取得
            clicks.forEach(click => {
                csvContent += `${click.action},${click.timestamp}\n`; // CSVにデータを追加
            });
        });

        // ダウンロード処理
            const now = new Date(); /* 現在の日時を取得 */
            const timestamp = now.toLocaleString('ja-JP', { timeZone: 'Asia/Tokyo' }).replace(/[:/]/g, '-').replace(/\s/g, '_'); /* 日本時間で日時をフォーマットし、ファイル名に使用できる形式に変換 */
            const filename = `出退記録_${timestamp}.csv`; /* ファイル名を生成 */

            const encodedUri = encodeURI(csvContent); /* CSVコンテンツをURI形式にエンコード */
            const link = document.createElement("a"); /* 新しいa要素を作成 */
            link.setAttribute("href", encodedUri); /* a要素にダウンロードリンクを設定 */
            link.setAttribute("download", filename); /* a要素にダウンロードファイル名を設定 */
            document.body.appendChild(link); /* a要素をドキュメントに追加（Firefox用） */
            link.click(); /* a要素をクリックしてダウンロードを開始 */
            document.body.removeChild(link); /* a要素をドキュメントから削除 */
        }

// ローカルストレージをクリアする関数
        function clearLocalStorage() {
            localStorage.clear(); // ローカルストレージをクリア
            const buttons = document.querySelectorAll('.button'); // すべてのボタンを取得
            buttons.forEach(button => {
                button.classList.remove('clicked'); // ボタンのクリック状態をリセット
            });
        }

// ハンバーガーメニューの関数
	function toggleMenu() {
        const menu = document.getElementById('menu');
        const menuIcon = document.querySelector('.menu-icon');
            
            // メニューとアイコンのアクティブ状態を切り替え
            menu.classList.toggle('active');
            menuIcon.classList.toggle('active');
        }


// 午後5時にdownloadCSVを実行する関数
    function scheduleDownload() {
    const now = new Date();
    const target = new Date(); // 今日の日付
    target.setHours(17, 0, 0, 0); // 午後5時に設定

    // 現在時刻が午後5時を過ぎている場合、翌日の午後5時に設定
    if (now > target) {
        target.setDate(target.getDate() + 1);
    }

    // 現在から午後5時までの残り時間を計算 (ミリ秒単位)
    const timeUntilTarget = target - now;

    console.log(`ダウンロードは ${target} に実行されます。`);

    // タイマーを設定
    setTimeout(() => {
        downloadCSV(); // downloadCSVを実行
        scheduleDownload(); // 次のダウンロードをスケジュール
    }, timeUntilTarget);
}

// 初回のスケジュールを設定
scheduleDownload();



    </script>

</body>
</html>
